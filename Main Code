//Plantuino Main Code:

//Libraries
#include <DHT.h> //DHT sensor
#include <Adafruit_seesaw.h>  //moisture sensor
#include <SPI.h> //SD card
#include <SD.h> //SD card

//initializng input pins
const int lightSensorPin=0;      
const int moistureSensorSDA_Pin=4; 
const int dhtPin=2; //temperature and humidity sensor

//intializing clock pin
const int moistureSensorSCL_Pin=5;

//intializing relay module
const int relayPin=???;             //FIX ME

//initializing output pins
const int valvePin=???;             //FIX ME
const int fanPin=???;               //FIX ME
const int lightPin=???;             //FIX ME

//initializing variables
float temperatureVal=0;
float humidityVal=0;
int moistureVal=0; //FIX ME should this be float?
int lightVal=0; //FIX ME should this be float?

//DHT22 initialization
#define DHTPIN 2     //what pin the sensor is connected to
#define DHTTYPE DHT22 
DHT dht(DHTPIN, DHTTYPE);

//sd card intializiation
File sensorDataFile;



void setup() {
  
  pinMode(dhtPin,INPUT);
  pinMode(lightSensorPin,INPUT);
  pinMode(moistureSensorSDA_Pin,INPUT);

  pinMode(valvePin,OUTPUT);
  pinMode(fanPin,OUTPUT);
  pinMode(lightPin,OUTPUT);
  pinMode(moistureSensorSCL_Pin,OUTPUT); //clock

  dht.begin();

  Serial.begin(9600);
  while (!Serial) {; // wait for serial port to connect. Needed for native USB port only
  }
  Serial.print("Initializing SD card...");

  if (!SD.begin(10)) {
  Serial.println("initialization failed!");
  while (1);

  Serial.println("initialization done.");

  sensorDataFile=SD.open("data.txt", FILE_WRITE);
  sensorDataFile.println("Temp Sensor, Humidity Sesnor, Light Sensor, Moisture Sensor");
  sensorDataFile.close();


}

void loop() {
  
  temperatureVal=dht.readTemperature();
  humidityVal=dht.readHumidity();
  moistureVal=analogRead(moistureSensorSDA_Pin); 
  lightVal=analogRead(lightPin);
  
  if(/*condition not met for soil moisture */){ //this opens the watering valve          //FIX ME
    digitWrite(valvePin,HIGH);
  } else // this closes the valve
    digitWrite(valvePin,LOW); 
    
/*    NOT USING THIS YET    

  if(condition not met for light){ //this turns on the growing light        //FIX ME
    digitWrite(lightPin,HIGH);
  } else // this turns off the light
    digitWrite(lightPin,LOW);
    
  if(condition not met for temperature){ //this turns on the fan            //FIX ME
    digitWrite(fanPin,HIGH);
  } else // this turns off the fan
    digitWrite(fanPin,LOW);
*/

  sensorDataFile = SD.open("data.txt", FILE_WRITE);

  //data logging:
  if (sensorDataFile) {
    Serial.print("Writing to data.txt...");
    sensorDataFile.print(dht.readTemperature());
    sensorDataFile.print(" ");
    sensorDataFile.print(humidityVal=dht.readHumidity());
    sensorDataFile.print(" ");
    sensorDataFile.print(analogRead(lightPin));
    sensorDataFile.print(" ");
    sensorDataFile.println(analogRead(moistureSensorSDA_Pin));
    sensorDataFile.close();
    Serial.println("done.");
  } else {
    Serial.println("error opening data.txt");
  }

  delay(2000);   //FIX ME (how long should we wait to take measurements again?)
}
